#setw -gq utf8 on
#
## Colors
#set -g default-terminal "tmux-256color"
## set explicit RGB color support
#set -sa terminal-features ',tmux-256color:RGB'
## Finally set the overrides for both colors and italics
#set -as terminal-overrides ',*:Tc:sitm=\E[3m:ritm=\E[23m'
##set -as terminal-features ',alacritty:RGB'
##set -ga terminal-overrides ',alacritty:RGB'
##set -as terminal-overrides ',*:sitm=\E[3m:ritm=\E[23m'
#
## Mappings
### Remap prefix from 'C-b' to 'C-a'
#unbind C-b
#set-option -g prefix C-a
#bind-key C-a send-prefix
#
## Vim
#setw -g mode-keys vi
### Use vim yank to copy to clipboard
#bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy -in -selection clipboard'
#
### Plugin settings
#set -g @continuum-restore 'on'
#set focus-events
#set -sg escape-time 0 # fixes insert mode exit lag in vim
#set -g @spotify_playing_icon " üîä  "
#set -g @spotify_paused_icon " ÔÅå  "
## optional: defaults to `paused_icon`
#set -g @spotify_stopped_icon " ‚ùå "
#
## Window and pane settings
### Window titles
#set -g set-titles on
### split panes using | and -
#bind | split-window -h
#bind - split-window -v
#unbind '"'
#unbind %
### Start windows and panes at 1, not 0
#set -g base-index 1
#setw -g pane-base-index 1
### swap window to left or right
#bind-key -r < swap-window -t -1
#bind-key -r > swap-window -t +1
### Don't prompt to kill panes/windows.
#bind-key x kill-pane
#bind-key & kill-window
### Shift arrow to switch windows
#bind -n S-Left  previous-window
#bind -n S-Right next-window
##resize panes using mouse
#set-option -g mouse on
## Resize the current pane using Alt + direction
#bind -r k resize-pane -U 10
#bind -r j resize-pane -D 10
#bind -r h resize-pane -L 10
#bind -r l resize-pane -R 10
### Smart pane switching with awareness of Vim splits.
### See: https://github.com/christoomey/vim-tmux-navigator
#is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
#    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
#bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
#bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
#bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
#bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
#tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
#if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
#    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
#if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
#    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"
#bind-key -n 'C-Space' if-shell "$is_vim" 'send-keys C-Space' 'select-pane -t:.+'
#bind-key -T copy-mode-vi 'C-h' select-pane -L
#bind-key -T copy-mode-vi 'C-j' select-pane -D
#bind-key -T copy-mode-vi 'C-k' select-pane -U
#bind-key -T copy-mode-vi 'C-l' select-pane -R
#bind-key -T copy-mode-vi 'C-\' select-pane -l
#bind-key -T copy-mode-vi 'C-Space' select-pane -t:.+
#
## Statusbar settings
### Notify about activities
#setw -g monitor-activity on
#set -g visual-activity on
### Time for status line messages are displayed
#set -g display-time 250
#setw -g automatic-rename on
##set-option -g automatic-rename-format '#{b:pane_current_path}'
#
#set -g status on
#set -g status-interval 60
#set -g status-left ""
#set -g status-justify left # center align window list
#set-option -g status-position bottom
#set-option -g status-style fg=white,bg=default,default
#
## Window status format for inactive windows
#set -g window-status-format "#[bg=#2d353b]#[fg=#859289] #I#F #[fg=#859289]‚ùØ> #[fg=#859289]#W  #[bg=default]"
## Window status format for active window
#set -g window-status-current-format "#[bg=#2d353b] #I#{?window_flags,#F, } #[fg=#83c092]‚ùØ> #[fg=#d3c6aa]#W  #[bg=default]"
## Default status bar colors
#set-option -qg status-style "fg=#859289"
## Default window title colors
#set-window-option -qg window-status-style "fg=#d3c6aa"
## Window status colors for activity
#set-window-option -qg window-status-activity-style "fg=#e69875"
## Window status colors for bell
#set-window-option -qg window-status-bell-style "fg=#e67e80"
#
## Spotify display
#set -g status-right-length 150
#set -g status-right "ÔÜº |#{artist}: #{track}#{music_status}| %a %h-%d %H:%M "
#
## Plugins
#set -g @plugin 'tmux-plugins/tmux-resurrect'
#set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin 'tmux-plugins/tmux-continuum'
#set -g @plugin 'robhurring/tmux-spotify'
#
#run -b '~/.tmux/plugins/tpm/tpm'

# ====================
# = Settings & Colors
# ====================
setw -gq utf8 on

# Terminal color settings for proper color and italic support
set -g default-terminal "tmux-256color"
set -sa terminal-features ',tmux-256color:RGB'  # Enable RGB color support
set -as terminal-overrides ',*:Tc:sitm=\E[3m:ritm=\E[23m'  # Enable true colors and italics

# ====================
# = Key Bindings
# ====================
# Change prefix from ctrl-b to ctrl-a (like screen)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# ====================
# = Vim Integration
# ====================
# Enable vi keys
setw -g mode-keys vi

# Copy to system clipboard in vi-copy mode
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy -in -selection clipboard'

# ====================
# = Plugin Settings
# ====================
set -g @continuum-restore 'on'  # Restore tmux environment on start
set focus-events              # Focus events enabled for terminals that support them
set -sg escape-time 0        # Fix vim mode switching delay

# ====================
# = Window & Pane Management
# ====================
# Window settings
set -g set-titles on         # Set terminal title
set -g base-index 1          # Start window numbering at 1
setw -g pane-base-index 1    # Start pane numbering at 1

# Pane splitting
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Window management
bind-key -r < swap-window -t -1  # Move window left
bind-key -r > swap-window -t +1  # Move window right
bind-key x kill-pane             # Kill pane without confirmation
bind-key & kill-window           # Kill window without confirmation

# Window navigation
bind -n S-Left  previous-window
bind -n S-Right next-window

# Mouse support
set-option -g mouse on

# Pane resizing
bind -r k resize-pane -U 10
bind -r j resize-pane -D 10
bind -r h resize-pane -L 10
bind -r l resize-pane -R 10

# ====================
# = Smart Pane Navigation (Vim Integration)
# ====================
# Smart pane switching with awareness of Vim splits
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

# Version-specific settings for backward compatibility
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

# Additional navigation bindings
bind-key -n 'C-Space' if-shell "$is_vim" 'send-keys C-Space' 'select-pane -t:.+'
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
bind-key -T copy-mode-vi 'C-Space' select-pane -t:.+

# ====================
# = Status Bar Configuration
# ====================
# Activity monitoring
setw -g monitor-activity on
set -g visual-activity on
set -g display-time 250
setw -g automatic-rename on

# Status bar general settings
set -g status on
set -g status-interval 60
set -g status-left ""
set -g status-justify left
set-option -g status-position bottom
set-option -g status-style fg=white,bg=default,default

# Window status styling (Everforest theme colors)
set -g window-status-format "#[bg=#2d353b]#[fg=#859289] #I#F #[fg=#859289]‚ùØ> #[fg=#859289]#W  #[bg=default]"
set -g window-status-current-format "#[bg=#2d353b] #I#{?window_flags,#F, } #[fg=#83c092]‚ùØ> #[fg=#d3c6aa]#W  #[bg=default]"

# Status bar colors
set-option -qg status-style "fg=#859289"
set-window-option -qg window-status-style "fg=#d3c6aa"
set-window-option -qg window-status-activity-style "fg=#e69875"
set-window-option -qg window-status-bell-style "fg=#e67e80"

# Right status bar (Spotify + time)
set -g @spotify_playing_icon " üîä  "
set -g @spotify_paused_icon " ÔÅå "
set -g @spotify_stopped_icon " ‚ùå "
set -g status-right-length 150
set -g status-right  " ÔÜº ÔÄÅ |#{artist}: #{track}#{music_status}| %a %h-%d %H:%M "

# ====================
# = Plugins
# ====================
set -g @plugin 'tmux-plugins/tmux-resurrect'    # Save/restore tmux sessions
set -g @plugin 'tmux-plugins/tpm'               # Tmux package manager
set -g @plugin 'tmux-plugins/tmux-continuum'    # Auto save/restore tmux sessions
set -g @plugin 'robhurring/tmux-spotify'        # Spotify integration

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
